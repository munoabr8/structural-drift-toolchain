#!/usr/bin/env bash
set -euo pipefail
[[ "${DISABLE_HOOKS:-0}" == "1" ]] && exit 0

ts=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
cmd=${1:-unknown}                                  # usually "amend" or "rebase"
log="$(git rev-parse --git-path risk-log)"

# stdin: "<oldsha> <newsha> <type?>" per line
while read -r old new _; do
  echo "post-rewrite: $ts cmd=$cmd branch=$(git rev-parse --abbrev-ref HEAD) old=$old new=$new" >> "$log"
done
